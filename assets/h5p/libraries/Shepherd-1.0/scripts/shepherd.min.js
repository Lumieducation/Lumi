!function(t,e){"function"==typeof define&&define.amd?define(["tether"],e):"object"==typeof exports?module.exports=e(require("tether")):t.Shepherd=e(t.Tether)}(this,(function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}function n(t){var e=document.createElement("div");return e.innerHTML=t,e.children[0]}function o(t,e){if(null==t)return t;if("object"==typeof t)return t;var i=t.split(" "),n=i.length,o=e.length;n>o&&(i[0]=i.slice(0,n-o+1).join(" "),i.splice(1,o));for(var r={},s=0;o>s;++s)r[e[s]]=i[s];return r}var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(t,e,i){for(var n=!0;n;){var o=t,r=e,s=i;c=void 0,n=!1;var h=Object.getOwnPropertyDescriptor(o,r);if(void 0!==h){if("value"in h)return h.value;var c=h.get;return void 0===c?void 0:c.call(s)}var a=Object.getPrototypeOf(o);if(null===a)return;t=a,e=r,i=s,n=!0}},h=t.Utils,c=h.Evented,a=h.addClass,u=h.extend,l=h.hasClass,d=h.removeClass,p=h.uniqueId,v=new c,f={top:"bottom center",left:"middle right",right:"middle left",bottom:"top center",center:"middle center"},y=function(h){function c(t,i){return e(this,c),s(Object.getPrototypeOf(c.prototype),"constructor",this).call(this,t,i),this.tour=t,this.bindMethods(),this.setOptions(i),this}return i(c,h),r(c,[{key:"bindMethods",value:function(){var t=this;["_show","show","hide","isOpen","cancel","complete","scrollTo","destroy"].map((function(e){t[e]=t[e].bind(t)}))}},{key:"setOptions",value:function(){var t=void 0===arguments[0]?{}:arguments[0];this.options=t,this.destroy(),this.id=this.options.id||this.id||"step-"+p();var e=this.options.when;if(e)for(var i in e)if({}.hasOwnProperty.call(e,i)){var n=e[i];this.on(i,n,this)}this.options.buttons||(this.options.buttons=[{text:"Next",action:this.tour.next}])}},{key:"getTour",value:function(){return this.tour}},{key:"bindAdvance",value:function(){var t=this,e=o(this.options.advanceOn,["selector","event"]),i=e.event,n=e.selector,r=function(e){t.isOpen()&&(void 0!==n?function(t,e){var i=void 0;return void 0!==t.matches?i=t.matches:void 0!==t.matchesSelector?i=t.matchesSelector:void 0!==t.msMatchesSelector?i=t.msMatchesSelector:void 0!==t.webkitMatchesSelector?i=t.webkitMatchesSelector:void 0!==t.mozMatchesSelector?i=t.mozMatchesSelector:void 0!==t.oMatchesSelector&&(i=t.oMatchesSelector),i.call(t,e)}(e.target,n)&&t.tour.next():t.el&&e.target===t.el&&t.tour.next())};document.body.addEventListener(i,r),this.on("destroy",(function(){return document.body.removeEventListener(i,r)}))}},{key:"getAttachTo",value:function(){var t=o(this.options.attachTo,["element","on"])||{},e=t.element;if("string"==typeof e&&(t.element=document.querySelector(e),!t.element))throw new Error("The element for this Shepherd step was not found "+e);return t}},{key:"setupTether",value:function(){if(void 0===t)throw new Error("Using the attachment feature of Shepherd requires the Tether library");var e=this.getAttachTo(),i=f[e.on||"right"];void 0===e.element&&(e.element="viewport",i="middle center");var n={classPrefix:"shepherd",element:this.el,constraints:[{to:"window",pin:!0,attachment:"together"}],target:e.element,offset:e.offset||"0 0",attachment:i};this.tether=new t(u(n,this.options.tetherOptions))}},{key:"show",value:function(){var t=this;if(void 0!==this.options.beforeShowPromise){var e=this.options.beforeShowPromise();if(void 0!==e)return e.then((function(){return t._show()}))}this._show()}},{key:"_show",value:function(){var t=this;this.trigger("before-show"),this.el||this.render(),a(this.el,"shepherd-open"),document.body.setAttribute("data-shepherd-step",this.id),this.setupTether(),this.options.scrollTo&&setTimeout((function(){t.scrollTo()})),this.trigger("show")}},{key:"hide",value:function(){this.trigger("before-hide"),d(this.el,"shepherd-open"),document.body.removeAttribute("data-shepherd-step"),this.tether&&this.tether.destroy(),this.tether=null,this.trigger("hide")}},{key:"isOpen",value:function(){return l(this.el,"shepherd-open")}},{key:"cancel",value:function(){this.tour.cancel(),this.trigger("cancel")}},{key:"complete",value:function(){this.tour.complete(),this.trigger("complete")}},{key:"scrollTo",value:function(){var t=this.getAttachTo().element;void 0!==this.options.scrollToHandler?this.options.scrollToHandler(t):void 0!==t&&t.scrollIntoView()}},{key:"destroy",value:function(){void 0!==this.el&&(document.body.removeChild(this.el),delete this.el),this.tether&&this.tether.destroy(),this.tether=null,this.trigger("destroy")}},{key:"render",value:function(){var t=this;void 0!==this.el&&this.destroy(),this.el=n("<div class='shepherd-step "+(this.options.classes||"")+"' data-id='"+this.id+"' "+(this.options.idAttribute?'id="'+this.options.idAttribute+'"':"")+"></div>");var e=document.createElement("div");e.className="shepherd-content",this.el.appendChild(e);var i=document.createElement("header");if(e.appendChild(i),void 0!==this.options.title&&(i.innerHTML+="<h3 class='shepherd-title'>"+this.options.title+"</h3>",this.el.className+=" shepherd-has-title"),this.options.showCancelLink){var o=n("<a href class='shepherd-cancel-link'>âœ•</a>");i.appendChild(o),this.el.className+=" shepherd-has-cancel-link",this.bindCancelLink(o)}void 0!==this.options.text&&function(){var i=n("<div class='shepherd-text'></div>"),o=t.options.text;"function"==typeof o&&(o=o.call(t,i)),o instanceof HTMLElement?i.appendChild(o):("string"==typeof o&&(o=[o]),o.map((function(t){i.innerHTML+="<p>"+t+"</p>"}))),e.appendChild(i)}();var r=document.createElement("footer");this.options.buttons&&function(){var e=n("<ul class='shepherd-buttons'></ul>");t.options.buttons.map((function(i){var o=n("<li><a class='shepherd-button "+(i.classes||"")+"'>"+i.text+"</a>");e.appendChild(o),t.bindButtonEvents(i,o.querySelector("a"))})),r.appendChild(e)}(),e.appendChild(r),document.body.appendChild(this.el),this.setupTether(),this.options.advanceOn&&this.bindAdvance()}},{key:"bindCancelLink",value:function(t){var e=this;t.addEventListener("click",(function(t){t.preventDefault(),e.cancel()}))}},{key:"bindButtonEvents",value:function(t,e){var i=this;for(var n in t.events=t.events||{},void 0!==t.action&&(t.events.click=t.action),t.events)if({}.hasOwnProperty.call(t.events,n)){var o=t.events[n];"string"==typeof o&&function(){var t=o;o=function(){return i.tour.show(t)}}(),e.addEventListener(n,o)}this.on("destroy",(function(){for(var i in t.events)if({}.hasOwnProperty.call(t.events,i)){var n=t.events[i];e.removeEventListener(i,n)}}))}}]),c}(c),m=function(t){function n(){var t=this,i=void 0===arguments[0]?{}:arguments[0];return e(this,n),s(Object.getPrototypeOf(n.prototype),"constructor",this).call(this,i),this.bindMethods(),this.options=i,this.steps=this.options.steps||[],["complete","cancel","hide","start","show","active","inactive"].map((function(e){!function(e){t.on(e,(function(i){(i=i||{}).tour=t,v.trigger(e,i)}))}(e)})),this}return i(n,t),r(n,[{key:"bindMethods",value:function(){var t=this;["next","back","cancel","complete","hide"].map((function(e){t[e]=t[e].bind(t)}))}},{key:"addStep",value:function(t,e){return void 0===e&&(e=t),e instanceof y?e.tour=this:(("string"==typeof t||"number"==typeof t)&&(e.id=t.toString()),e=u({},this.options.defaults,e),e=new y(this,e)),this.steps.push(e),this}},{key:"getById",value:function(t){for(var e=0;e<this.steps.length;++e){var i=this.steps[e];if(i.id===t)return i}}},{key:"getCurrentStep",value:function(){return this.currentStep}},{key:"next",value:function(){var t=this.steps.indexOf(this.currentStep);t===this.steps.length-1?(this.hide(t),this.trigger("complete"),this.done()):this.show(t+1)}},{key:"back",value:function(){var t=this.steps.indexOf(this.currentStep);this.show(t-1)}},{key:"cancel",value:function(){void 0!==this.currentStep&&this.currentStep.hide(),this.trigger("cancel"),this.done()}},{key:"complete",value:function(){void 0!==this.currentStep&&this.currentStep.hide(),this.trigger("complete"),this.done()}},{key:"hide",value:function(){void 0!==this.currentStep&&this.currentStep.hide(),this.trigger("hide"),this.done()}},{key:"done",value:function(){v.activeTour=null,d(document.body,"shepherd-active"),this.trigger("inactive",{tour:this})}},{key:"show",value:function(){var t=void 0===arguments[0]?0:arguments[0];this.currentStep?this.currentStep.hide():(a(document.body,"shepherd-active"),this.trigger("active",{tour:this})),v.activeTour=this;var e=void 0;(e="string"==typeof t?this.getById(t):this.steps[t])&&(this.trigger("show",{step:e,previous:this.currentStep}),this.currentStep=e,e.show())}},{key:"start",value:function(){this.trigger("start"),this.currentStep=null,this.next()}}]),n}(c);return u(v,{Tour:m,Step:y,Evented:c}),v}));